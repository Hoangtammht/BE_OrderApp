<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.demo.dao.OrderMapper">

    <insert id="createOrder" keyProperty="orderID" parameterType="com.example.demo.domain.request.RequestOrder">
        INSERT INTO `Order` (userID, menuID, classID, quantity, totalPrice, createdAt)
        VALUES (#{userID}, #{menuID}, #{classID}, #{quantity}, #{totalPrice}, #{createdAt})
    </insert>

    <select id="getOrdersByDateRange" resultType="com.example.demo.domain.response.ResponseOrder">
        SELECT
            orderID,
            U.userName,
            M.dishName,
            S.className,
            quantity,
            totalPrice,
            O.createdAt,
            O.updatedAt
        FROM `Order` O, Menu M, User U, Class S
            WHERE
        O.userID = u.userID AND O.classID = S.classID AND O.menuID = M.menuID
        AND DATE(O.createdAt) BETWEEN #{from} AND #{to}
    </select>

    <select id="getOrdersByTeacher" resultType="com.example.demo.domain.response.ResponseOrder">
        SELECT
        orderID,
        U.userName,
        M.dishName,
        S.className,
        quantity,
        totalPrice,
        O.createdAt,
        O.updatedAt
        FROM
        `Order` O
        JOIN
        Menu M ON O.menuID = M.menuID
        JOIN
        User U ON O.userID = U.userID
        JOIN
        Class S ON O.classID = S.classID
        WHERE
        U.userName LIKE CONCAT('%', #{userName}, '%')
        ORDER BY
        O.orderID DESC
    </select>


</mapper>